<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi Tiết Sản Phẩm - Giày Dép Hương Nhớ</title>
    <link rel="icon" href="/favicon.jpg" type="image/jpeg">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <header class="header">
        <div class="header-container">
            <a href="/" class="logo"><img src="images/logo.jpg" alt="Giày Dép Hương Nhớ"></a>
            <nav class="nav"><a href="/">Trang Chủ</a><a href="/products.html">Sản Phẩm</a></nav>
            <div class="header-actions">
                <button class="cart-btn" onclick="toggleCart()"><i class="fas fa-shopping-bag"></i><span
                        class="cart-count" id="cart-count">0</span></button>
                <div id="auth-section"></div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="product-detail" id="product-detail">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <div class="cart-sidebar" id="cart-sidebar">
        <div class="cart-header">
            <h3><i class="fas fa-shopping-bag"></i> Giỏ Hàng</h3><button class="modal-close" onclick="toggleCart()"><i
                    class="fas fa-times"></i></button>
        </div>
        <div class="cart-items" id="cart-items"></div>
        <div class="cart-footer">
            <div class="cart-total"><span>Tổng:</span><span id="cart-total">0đ</span></div><a href="/cart.html"
                class="btn btn-primary btn-block">Xem Giỏ Hàng</a>
        </div>
    </div>
    <div class="modal-overlay" id="cart-overlay" onclick="toggleCart()"></div>
    <div class="toast-container" id="toast-container"></div>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/main.js"></script>
    <script>
        let currentProduct = null;
        let quantity = 1;

        async function loadProduct() {
            const id = new URLSearchParams(window.location.search).get('id');
            if (!id) { window.location.href = '/products.html'; return; }

            try {
                const [product] = await Promise.all([
                    productsAPI.getById(id),
                    new Promise(resolve => setTimeout(resolve, 500))
                ]);
                currentProduct = product;
                document.title = `${currentProduct.name} - Giày Dép Hương Nhớ`;

                document.getElementById('product-detail').innerHTML = `
          <div class="product-gallery"><img src="${currentProduct.image || ''}" alt="${currentProduct.name}"></div>
          <div class="product-detail-info">
            <div class="product-category">${currentProduct.category || 'Giày dép'}</div>
            <h1>${currentProduct.name}</h1>
            <div class="product-detail-price">
              ${currentProduct.discountedPrice
                        ? `<span>${formatPrice(currentProduct.discountedPrice)}</span><span class="price-old" style="font-size:1.2rem;margin-left:1rem">${formatPrice(currentProduct.price)}</span>`
                        : formatPrice(currentProduct.price)}
            </div>
            <p class="product-detail-desc">${currentProduct.description || ''}</p>
            <p style="color:var(--gray);margin-bottom:1rem"><i class="fas fa-box"></i> Còn ${currentProduct.stock} sản phẩm</p>
            <div class="quantity-selector">
              <label>Số lượng:</label>
              <div class="quantity-input">
                <button onclick="changeQty(-1)">-</button>
                <input type="number" id="qty" value="1" min="1" max="${currentProduct.stock}" readonly>
                <button onclick="changeQty(1)">+</button>
              </div>
            </div>
            <button class="btn btn-primary btn-block" onclick="addProductToCart()" ${currentProduct.stock <= 0 ? 'disabled' : ''}>
              <i class="fas fa-shopping-cart"></i> ${currentProduct.stock > 0 ? 'Thêm vào giỏ hàng' : 'Hết hàng'}
            </button>
          </div>
        `;

                // Add Structured Data for SEO
                const script = document.createElement('script');
                script.type = 'application/ld+json';
                script.text = JSON.stringify({
                    "@context": "https://schema.org/",
                    "@type": "Product",
                    "name": currentProduct.name,
                    "image": currentProduct.image,
                    "description": currentProduct.description,
                    "sku": currentProduct.id,
                    "offers": {
                        "@type": "Offer",
                        "url": window.location.href,
                        "priceCurrency": "VND",
                        "price": currentProduct.discountedPrice || currentProduct.price,
                        "availability": currentProduct.stock > 0 ? "https://schema.org/InStock" : "https://schema.org/OutOfStock",
                        "itemCondition": "https://schema.org/NewCondition"
                    }
                });
                document.head.appendChild(script);
            } catch (error) {
                document.getElementById('product-detail').innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><h3>Sản phẩm không tồn tại</h3><a href="/products.html" class="btn btn-primary">Xem sản phẩm khác</a></div>';
            }
        }

        function changeQty(delta) {
            quantity = Math.max(1, Math.min(currentProduct.stock, quantity + delta));
            document.getElementById('qty').value = quantity;
        }

        function addProductToCart() {
            if (currentProduct && currentProduct.stock > 0) {
                addToCart(currentProduct.id, quantity, currentProduct);
            }
        }

        document.addEventListener('DOMContentLoaded', loadProduct);
    </script>
</body>

</html>